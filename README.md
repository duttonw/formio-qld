# Queensland Government Form.io custom component library

This repository provides a bundled JS custom component library to form.io builder / form.io renderer / Squiz Matrix form application.

<img src="https://qld-gov-au.github.io/formio/static/media/formio%20custom%20component.5f82e1bf.png" alt="share diagram" width="480" />

## Goals

Following are the goals of this repository.

### Primary

| Goal           | Description                                                                                                                                                                             | Solution                                                                                       |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| JS Bundling    | Bundles a single JS file used in Form.io builder [project settings](https://help.form.io/userguide/projects#custom-js-and-css), which also can be attached by any renderer applications | [Webpack](https://webpack.js.org/) + [Babel](https://babeljs.io/)                              |
| Support IE11   | es5+ JS will be used in dev environment, but needs to be compiled in the bundled file                                                                                                   | [Babel polyfill](https://babeljs.io/docs/en/babel-polyfill/)                                   |
| CI/CD          | Needs a automatic pipeline for doc and CDN deployment                                                                                                                                   | [Github Actions](https://github.com/features/actions)                                          |
| CDN deployment | Bundled JS file needs to be delivered by CDN                                                                                                                                            | Separate Bitbucket repository + [Bamboo](https://servicesmadesimpler.govnet.qld.gov.au/bamboo) |

### Secondary

| Goal                     | Description                                                                 | Solution                                                                                                   |
| ------------------------ | --------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| Development environment  | for local development                                                       | [Storybook](https://storybook.js.org/)                                                                     |
| Documentation deployment | for hosting the doc generated by Storybook                                  | [Github Page](https://pages.github.com/)                                                                   |
| Testable                 | provides testing infrastructure for local testing and CI/CD                 | [Jest](https://jestjs.io/) + [Testing Library](https://testing-library.com/docs/dom-testing-library/intro) |
| Code quality             | for development consistency and reducing merge conflicts due to code format | [esLint](https://eslint.org/) + [Prettier](https://prettier.io/)                                           |

### Optional

| Goal           | Description                                                                                      | Solution                                      |
| -------------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------- |
| Visual testing | Optional because this project focus more on functionality and doesn't involve style modification | [Chromatic](https://www.chromatic.com/)       |
| Typescript     | improve code quality but require more development resources and developer skill                  | [Typescript](https://www.typescriptlang.org/) |

## Development

Storybook is the main development environment in this repository.

### Local development

- Create a feature branch from `main`.
- Install packages with `npm install`.
- Start development environment with `npm run storybook`.
- Create / Modify components in `src/components`.
- Update `src/components/index.js` for new component.
- Lint and test with `npm run validate`.
- Push your branch and create pull request to merge to `develop` branch.

### Remote testing in Squiz Matrix

- We have a DEV gitBridge in asset `formio-cdn #248740`
- Sync the gitBridge with the branch you want to test in https://github.com/qld-gov-au/formio-qld, eg. `develop`.

## Deployment

### Deploy to https://github.com/qld-gov-au/formio-qld

Push any branches in https://github.com/qld-gov-au/formio will create a co-responding branch in https://github.com/qld-gov-au/formio-qld.
Then you can use gitBridge to test the modules in Squiz Matrix.

### Release to CDN

- Update the version number in `package.json`, you can review the latest tag number by `git tag -l`.
- Create a tag in https://github.com/qld-gov-au/formio, by running `git tag -a vx.x.x -m "your message"`, with the new version number you just updated.
- Push the tag to remote by `git push origin vx.x.x`, with the new version number you just updated.
- Create a PR on this commit/branch, then this will trigger the github action.
- https://github.com/qld-gov-au/formio-qld-cdn `release` branch will automatically generated a folder for the new version.
- The new folder in the above branch will automatically deploy to bamboo https://servicesmadesimpler.govnet.qld.gov.au/bamboo/browse/QSA-FOR/deployments DEV environment
- To deploy to TEST/BETA/PROD, simply manually deploy the release in https://servicesmadesimpler.govnet.qld.gov.au/bamboo/browse/QSA-FOR/deployments

## Usage

You can consume this library either in Form.io Builder or Form.io Renderer.

### Form.io platform builder

To use custom components in the Form.io platform builder, please go to the [Project stage settings](https://help.form.io/userguide/projects#custom-js-and-css) and update the `Custom javascript` URL with the CDN URL of this library:

```
https://dev-static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio-qld.min.js
(This is a temporary URL for POC purpose, actual CDN URL still needs to be confirmed in production.)
```

<img src="https://qld-gov-au.github.io/formio/static/media/formioSettings.fbfb01cf.png" alt="share diagram" width="640" />

### Form.io JS renderer or builder

To use custom components in the Form.io JS renderer, please include the script **AFTER** the formio script.
Pleaser refer to [Form.io doc](https://help.form.io/developers/form-renderer#getting-started) for how to initiate your form application in a HTML page.

```html
<script src="https://static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio.full.min.js"></script>
...
<script src="https://static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio-qld.min.js"></script>
```

## Folder structure

### src/components

Custom Formio components.

### src/helpers

Helper modules for integrate Formio into Squiz Matrix/consumer application.

### src/examples

Sample usage of Formio implementation in any applications.

### lib

Third party library files that going to be served by the CDN.

### builder

Backup/archived code snippet to be used in Formio platform.

## Alternative way to build/run

To not require install npm/node on your system, you can use the maven bootstrap method.

Install Java8+, Install Maven.

To run lint, tests, compile and build dist folder.

```shell
mvn clean install
```

to run storybook dev mode

```shell
mvn com.github.eirslett:frontend-maven-plugin:npm@storybook
```
