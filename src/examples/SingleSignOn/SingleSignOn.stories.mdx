import { Canvas, Meta, Story } from "@storybook/addon-docs";
import SSOHighLevel from "../../stories/assets/SSO-HighLevel.png";
import SSOUserFlow from "../../stories/assets/SSO-UserFlow.png";
import { createSSoForm } from "./SingleSignOn";
// eslint-disable-next-line import/no-unresolved, import/extensions
import { createSSoForm as createSSoFormRaw } from "!!./SingleSignOn";

<Meta title="Examples/SingleSignOn" />

# Single SignOn

To allow sso on FormIO, there are some extra hoops you need to jump through, there may also be a way to have it half way through your form.

https://servicesmadesimpler.govnet.qld.gov.au/wiki/display/QOL/Form.io+OICD+IDB+integration+POC+with+Freight+Pass

## High Level Architecture

Below is a high level diagram of Form.io integrating with the IDB and Freight Pass

<img src={SSOHighLevel} alt="SSO High Level" width="680" />

## Process Flow

Below is a high level process flow of Form.io integrating with the IDB and Freight Pass

### Definitions

Login Form : https://www.qld.gov.au/dev/steve/idb-poc-dev-use-only-login-to-freight-and-logistics-f-pass

Main Form : https://www.qld.gov.au/dev/steve/idb-poc-dev-use-only-queensland-border-declaration-pass-freight-and-logistics-f-pass

<img src={SSOUserFlow} alt="SSO User Flow" width="1680" />

## Demo

The following demo shows the SSO form in a single page application.

The demo can be reproduced with `FormioScript` to lazy load the Formio library and scripts.

export const createSSoFormCode = `
<head>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio-script.prod.min.js"></script>
</head>
<body>
  <script>
${createSSoFormRaw
  .toString()
  .replaceAll(
    "_helpers_FormioLoader__WEBPACK_IMPORTED_MODULE_0__",
    "FormLoader"
  )}
    FormioScript.init().then(() => {
      const div = createSSoForm();
      document.body.append(div);
    });
  </script>
</body>
`;

<Canvas withSource="open">
  <Story
    name="ssoDemo"
    parameters={{
      docs: {
        source: {
          code: createSSoFormCode,
          language: "html",
        },
      },
    }}
  >
    {() => createSSoForm()}
  </Story>
</Canvas>
