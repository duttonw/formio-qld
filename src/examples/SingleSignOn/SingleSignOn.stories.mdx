import { Canvas, Meta, Story } from "@storybook/addon-docs";
import SSOHighLevel from "../../stories/assets/SSO-HighLevel.png";
import SSOUserFlow from "../../stories/assets/SSO-UserFlow.png";
import { SingleSignOn } from "./stories/SingleSignOn";
import { singleSignOnCode } from "./stories/SingleSignOn.code";
import { SSOUnauth } from "./stories/SSOUnauth.js";
import { SSOUnauthCode } from "./stories/SSOUnauth.code.js";

<Meta title="Examples/SingleSignOn" />

# Single SignOn

To allow sso on FormIO, there are some extra hoops you need to jump through, there may also be a way to have it half way through your form.

https://servicesmadesimpler.govnet.qld.gov.au/wiki/display/QOL/Form.io+OICD+IDB+integration+POC+with+Freight+Pass

## High Level Architecture

Below is a high level diagram of Form.io integrating with the IDB and Freight Pass

<img src={SSOHighLevel} alt="SSO High Level" width="680" />

## Process Flow

Below is a high level process flow of Form.io integrating with the IDB and Freight Pass

### Definitions

Login Form : https://www.qld.gov.au/dev/steve/idb-poc-dev-use-only-login-to-freight-and-logistics-f-pass

Main Form : https://www.qld.gov.au/dev/steve/idb-poc-dev-use-only-queensland-border-declaration-pass-freight-and-logistics-f-pass

<img src={SSOUserFlow} alt="SSO User Flow" width="1680" />

## Demo

The following demo shows the SSO form in a single page application.

The demo can be reproduced with [FormioScript](?path=/docs/helpers-formioscript--page) to lazy-load the Formio library and scripts.

<Canvas withSource="open">
  <Story
    name="ssoDemo"
    parameters={{
      docs: {
        source: {
          code: singleSignOnCode,
          language: "html",
        },
      },
    }}
  >
    {() => SingleSignOn()}
  </Story>
</Canvas>

## If access the form without idb authentication

You could add condition to the form based on the auth token to display warning message or redirect.

<Canvas withSource="open">
  <Story
    name="ssoUnauth"
    parameters={{
      docs: {
        source: {
          code: SSOUnauthCode,
          language: "html",
        },
      },
    }}
  >
    {() => SSOUnauth()}
  </Story>
</Canvas>
